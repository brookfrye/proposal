# Code â†” Rmd Relationship (salary_growth_analysis.Rmd)

This note explains how the scripts in `code/` feed the analysis and outputs in `salary_growth_analysis.Rmd`.

## High-level flow

1) Build title comparables and pull payroll data
- `01_civil_service_titles.R` downloads the NYC Civil Service Titles dataset, assigns role groups (policy/data/counsel/web), removes a few levels, and writes `data/civ_serv_data_for_titles.csv`.
- `02_download_fy_25_salaries.R` pulls FY 2025 payroll rows for those titles and writes `data/fy25_bargun_comp_titles_salaries.csv`.

2) Clean and label FY 2025 salaries
- `00_depends.R` defines package imports and the Council staff/title lists used to bucket roles.
- `03_clean_salary_data.R` reads `data/fy25_bargun_comp_titles_salaries.csv`, assigns `grp`, `sys`, and `level`, filters to in-range salaries, and writes `data/fy25_sal_active.csv`.

3) Attrition comparisons across years
- `04_attrition.R` reads `data/salary_data_2018-2025_attrition.csv`, computes year-over-year attrition plus median salary/experience for departures, and creates `cmp`, `p1`, `p2`, and `p3` in the session.

4) Report assembly
- `salary_growth_analysis.Rmd` loads:
  - `data/fy25_sal_active.csv` (created by `03_clean_salary_data.R`) for all FY 2025 salary tables/plots.
  - `data/salary_data_2018-2025_attrition.csv` for attrition summaries.
  - `data/titles_groups_levels.csv` (external input; not generated by scripts in this folder).
- It also `source()`s:
  - `00_depends.R` for shared packages and role/title lists.
  - `04_attrition.R` to compute `cmp`, `p1`, and `p3` used in the Attrition section.

## What each script contributes to the Rmd

- `00_depends.R`
  - Inputs: none
  - Outputs: role/title lists (policy, counsel, data, web) and shared packages
  - Used by: `03_clean_salary_data.R`, `04_attrition.R`, and `salary_growth_analysis.Rmd`

- `01_civil_service_titles.R`
  - Inputs: NYC Civil Service Titles API
  - Outputs: `data/civ_serv_data_for_titles.csv`
  - Used by: `02_download_fy_25_salaries.R`

- `02_download_fy_25_salaries.R`
  - Inputs: `data/civ_serv_data_for_titles.csv`, NYC Payroll API
  - Outputs: `data/fy25_bargun_comp_titles_salaries.csv`
  - Used by: `03_clean_salary_data.R`

- `03_clean_salary_data.R`
  - Inputs: `data/fy25_bargun_comp_titles_salaries.csv`, lists from `00_depends.R`
  - Outputs: `data/fy25_sal_active.csv`
  - Used by: `salary_growth_analysis.Rmd` (FY 2025 tables and model)

- `04_attrition.R`
  - Inputs: `data/salary_data_2018-2025_attrition.csv`
  - Outputs (in-memory): `cmp`, `p1`, `p2`, `p3`
  - Used by: `salary_growth_analysis.Rmd` (Attrition summary + plots)

- `get_job_descriptions.R`
  - Inputs: NYC Jobs API
  - Outputs: `data/comp_city_job_postings_clean.csv`, `data/comp_city_counsel.csv`
  - Used by: not referenced in `salary_growth_analysis.Rmd` (standalone support for job description comparisons)

- `steps.R`
  - Inputs: `data/fy25_sal_active.csv`
  - Outputs: `gt` tables stored in `base_steps` and `senior_steps`
  - Used by: not referenced in `salary_growth_analysis.Rmd` (standalone step-table generator)

## Suggested run order (if regenerating data)

1) `01_civil_service_titles.R`
2) `02_download_fy_25_salaries.R`
3) `03_clean_salary_data.R`
4) `04_attrition.R`
5) Render `salary_growth_analysis.Rmd`
